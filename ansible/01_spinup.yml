- hosts: all
  remote_user: spinup

  tasks:


  - name: Disable root login over SSH
    become: true
    lineinfile: dest=/etc/ssh/sshd_config regexp="^PermitRootLogin" line="PermitRootLogin no" state=present
    notify:
      - restart sshd

  - name: Disable password login
    become: true
    lineinfile: dest=/etc/ssh/sshd_config regexp="^PasswordAuthentication" line="PasswordAuthentication no" state=present
    notify:
      - restart sshd


  - name: Gruppe "ansible" anlegen
    become: true
    group:
      name: ansible
      gid: 1100
      state: present

  - name: Benutzer "ansible" anlegen
    become: true
    user:
      name: ansible
      createhome: yes
      uid: 1100
      group: ansible
      state: present


  - name: Sudoers-Eintrag f√ºr Benutzer "ansible" anlegen
    become: true
    copy:
      dest: /etc/sudoers.d/ansible
      content: 'ansible ALL= NOPASSWD: ALL'
      owner: root
      group: root
      mode: 0500


  - name: Benutzer "ubuntu" entfernen
    become: true
    user:
      name: ubuntu
      state: absent
      remove: yes

  - name: Gruppe "ubuntu" entfernen
    become: true
    group:
      name: ubuntu
      state: absent


  handlers:
  - name: restart sshd
    service:
      name: sshd
      state: restarted
